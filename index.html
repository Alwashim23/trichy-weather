<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trichy Weather Dashboard</title>
<style>
    body { font-family: Arial; text-align:center; margin:50px; }
    h1,h3 { margin:5px; }
    #weather { font-size: 1.2em; margin-top: 20px; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>Trichy Weather Dashboard</h1>
<h3>Created by Alwashim A. | St. Joseph's College (Autonomous), Trichy</h3>

<div id="weather">Loading weather data...</div>

<script>
  // 1️⃣ Initialize Firebase
  const firebaseConfig = {
      databaseURL: "https://trichy-weather-default-rtdb.asia-southeast1.firebasedatabase.app"
  };
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // 2️⃣ Reference to /weather
  const ref = database.ref("/weather");

  // 3️⃣ Fetch the latest weather entry
  function fetchLatestWeather() {
    ref.orderByKey().limitToLast(1).once("value", snapshot => {
      let weatherData = null;
      snapshot.forEach(child => {
        weatherData = child.val();
      });

      if(weatherData){
        document.getElementById("weather").innerHTML = `
          <p>Temperature: ${weatherData.temperature}°C</p>
          <p>Humidity: ${weatherData.humidity}%</p>
          ${weatherData.timestamp ? `<p>Timestamp: ${weatherData.timestamp}</p>` : ''}
        `;
      } else {
        document.getElementById("weather").innerText = "No data available";
      }
    });
  }

  // Initial fetch
  fetchLatestWeather();

  // Auto-refresh every 30 seconds
  setInterval(fetchLatestWeather, 30000);
</script>

</body>
</html>
